import e from"../drag.min.js";import t from"./DropEvent.min.js";import o from"../../core/Interactable.min.js";import r from"../../core/scope.min.js";import*as n from"../../utils/index.min.js";function a(e,t){for(const{dropzone:o,element:r}of e.slice())t.dropzone=o,t.target=r,o.fire(t),t.propagationStopped=t.immediatePropagationStopped=!1}function i(e,t){const o=function({interactables:e},t){const o=[];for(const r of e.list){if(!r.options.drop.enabled)continue;const e=r.options.drop.accept;if(n.is.element(e)&&e!==t||n.is.string(e)&&!n.dom.matchesSelector(t,e)||n.is.func(e)&&!e({dropzone:r,draggableElement:t}))continue;const a=n.is.string(r.target)?r._context.querySelectorAll(r.target):n.is.array(r.target)?r.target:[r.target];for(const e of a)e!==t&&o.push({dropzone:r,element:e})}return o}(e,t);for(const e of o)e.rect=e.dropzone.getRect(e.element);return o}function p({dropState:e,interactable:t,element:o},r,a){const i=[];for(const{dropzone:n,element:p,rect:c}of e.activeDrops)i.push(n.dropCheck(r,a,t,o,p,c)?p:null);const p=n.dom.indexOfDeepestElement(i);return e.activeDrops[p]||null}function c(e,o,r){const{dropState:n}=e,a={enter:null,leave:null,activate:null,deactivate:null,move:null,drop:null};return"dragstart"===r.type&&(a.activate=new t(n,r,"dropactivate"),a.activate.target=null,a.activate.dropzone=null),"dragend"===r.type&&(a.deactivate=new t(n,r,"dropdeactivate"),a.deactivate.target=null,a.deactivate.dropzone=null),n.rejected||(n.cur.element!==n.prev.element&&(n.prev.dropzone&&(a.leave=new t(n,r,"dragleave"),r.dragLeave=a.leave.target=n.prev.element,r.prevDropzone=a.leave.dropzone=n.prev.dropzone),n.cur.dropzone&&(a.enter=new t(n,r,"dragenter"),r.dragEnter=n.cur.element,r.dropzone=n.cur.dropzone)),"dragend"===r.type&&n.cur.dropzone&&(a.drop=new t(n,r,"drop"),r.dropzone=n.cur.dropzone,r.relatedTarget=n.cur.element),"dragmove"===r.type&&n.cur.dropzone&&(a.move=new t(n,r,"dropmove"),a.move.dragmove=r,r.dropzone=n.cur.dropzone)),a}function d(e,t){const{dropState:o}=e,{activeDrops:r,cur:n,prev:i}=o;t.leave&&i.dropzone.fire(t.leave),t.move&&n.dropzone.fire(t.move),t.enter&&n.dropzone.fire(t.enter),t.drop&&n.dropzone.fire(t.drop),t.deactivate&&a(r,t.deactivate),o.prev.dropzone=n.dropzone,o.prev.element=n.element}function s({interaction:e,iEvent:t,event:o},r){if("dragmove"!==t.type&&"dragend"!==t.type)return;const{dropState:n}=e;r.dynamicDrop&&(n.activeDrops=i(r,e.element));const a=t,d=p(e,a,o);n.rejected=n.rejected&&!!d&&d.dropzone===n.cur.dropzone&&d.element===n.cur.element,n.cur.dropzone=d&&d.dropzone,n.cur.element=d&&d.element,n.events=c(e,0,a)}const l={id:"actions/drop",install(t){const{actions:o,interactStatic:r,Interactable:a,defaults:i}=t;t.usePlugin(e),a.prototype.dropzone=function(e){return function(e,t){if(n.is.object(t)){if(e.options.drop.enabled=!1!==t.enabled,t.listeners){const o=n.normalizeListeners(t.listeners),r=Object.keys(o).reduce((e,t)=>(e[/^(enter|leave)/.test(t)?"drag"+t:/^(activate|deactivate|move)/.test(t)?"drop"+t:t]=o[t],e),{});e.off(e.options.drop.listeners),e.on(r),e.options.drop.listeners=r}return n.is.func(t.ondrop)&&e.on("drop",t.ondrop),n.is.func(t.ondropactivate)&&e.on("dropactivate",t.ondropactivate),n.is.func(t.ondropdeactivate)&&e.on("dropdeactivate",t.ondropdeactivate),n.is.func(t.ondragenter)&&e.on("dragenter",t.ondragenter),n.is.func(t.ondragleave)&&e.on("dragleave",t.ondragleave),n.is.func(t.ondropmove)&&e.on("dropmove",t.ondropmove),/^(pointer|center)$/.test(t.overlap)?e.options.drop.overlap=t.overlap:n.is.number(t.overlap)&&(e.options.drop.overlap=Math.max(Math.min(1,t.overlap),0)),"accept"in t&&(e.options.drop.accept=t.accept),"checker"in t&&(e.options.drop.checker=t.checker),e}if(n.is.bool(t))return e.options.drop.enabled=t,e;return e.options.drop}(this,e)},a.prototype.dropCheck=function(e,t,o,r,a,i){return function(e,t,o,r,a,i,p){let c=!1;if(!(p=p||e.getRect(i)))return!!e.options.drop.checker&&e.options.drop.checker(t,o,c,e,i,r,a);const d=e.options.drop.overlap;if("pointer"===d){const e=n.getOriginXY(r,a,"drag"),o=n.pointer.getPageXY(t);o.x+=e.x,o.y+=e.y;const i=o.x>p.left&&o.x<p.right,d=o.y>p.top&&o.y<p.bottom;c=i&&d}const s=r.getRect(a);if(s&&"center"===d){const e=s.left+s.width/2,t=s.top+s.height/2;c=e>=p.left&&e<=p.right&&t>=p.top&&t<=p.bottom}if(s&&n.is.number(d)){const e=Math.max(0,Math.min(p.right,s.right)-Math.max(p.left,s.left))*Math.max(0,Math.min(p.bottom,s.bottom)-Math.max(p.top,s.top))/(s.width*s.height);c=e>=d}e.options.drop.checker&&(c=e.options.drop.checker(t,o,c,e,i,r,a));return c}(this,e,t,o,r,a,i)},r.dynamicDrop=e=>n.is.bool(e)?(t.dynamicDrop=e,r):t.dynamicDrop,n.extend(o.phaselessTypes,{dragenter:!0,dragleave:!0,dropactivate:!0,dropdeactivate:!0,dropmove:!0,drop:!0}),o.methodDict.drop="dropzone",t.dynamicDrop=!1,i.actions.drop=l.defaults},listeners:{"interactions:before-action-start"({interaction:e}){"drag"===e.prepared.name&&(e.dropState={cur:{dropzone:null,element:null},prev:{dropzone:null,element:null},rejected:null,events:null,activeDrops:[]})},"interactions:after-action-start"({interaction:e,event:t,iEvent:o},r){if("drag"!==e.prepared.name)return;const{dropState:n}=e;n.activeDrops=null,n.events=null,n.activeDrops=i(r,e.element),n.events=c(e,0,o),n.events.activate&&(a(n.activeDrops,n.events.activate),r.fire("actions/drop:start",{interaction:e,dragEvent:o}))},"interactions:action-move":s,"interactions:action-end":s,"interactions:after-action-move"({interaction:e,iEvent:t},o){"drag"===e.prepared.name&&(d(e,e.dropState.events),o.fire("actions/drop:move",{interaction:e,dragEvent:t}),e.dropState.events={})},"interactions:after-action-end"({interaction:e,iEvent:t},o){"drag"===e.prepared.name&&(d(e,e.dropState.events),o.fire("actions/drop:end",{interaction:e,dragEvent:t}))},"interactions:stop"({interaction:e}){if("drag"!==e.prepared.name)return;const{dropState:t}=e;t&&(t.activeDrops=null,t.events=null,t.cur.dropzone=null,t.cur.element=null,t.prev.dropzone=null,t.prev.element=null,t.rejected=!1)}},getActiveDrops:i,getDrop:p,getDropEvents:c,fireDropEvents:d,defaults:{enabled:!1,accept:null,overlap:"pointer"}};export default l;
//# sourceMappingURL=index.min.js.map
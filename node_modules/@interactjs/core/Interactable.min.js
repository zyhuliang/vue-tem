import t from"./Eventable.min.js";import{isNonNativeEvent as e}from"./scope.min.js";import*as s from"../utils/arr.min.js";import i from"../utils/browser.min.js";import n from"../utils/clone.min.js";import{getElementRect as o,matchesUpTo as r,nodeContains as c,trySelector as h}from"../utils/domUtils.min.js";import a from"../utils/extend.min.js";import*as l from"../utils/is.min.js";import m from"../utils/normalizeListeners.min.js";import{getWindow as u}from"../utils/window.min.js";export class Interactable{get _defaults(){return{base:{},perAction:{},actions:{}}}constructor(e,s,i,n){this.options=void 0,this._actions=void 0,this.target=void 0,this.events=new t,this._context=void 0,this._win=void 0,this._doc=void 0,this._scopeEvents=void 0,this._actions=s.actions,this.target=e,this._context=s.context||i,this._win=u(h(e)?this._context:e),this._doc=this._win.document,this._scopeEvents=n,this.set(s)}setOnEvents(t,e){return l.func(e.onstart)&&this.on(t+"start",e.onstart),l.func(e.onmove)&&this.on(t+"move",e.onmove),l.func(e.onend)&&this.on(t+"end",e.onend),l.func(e.oninertiastart)&&this.on(t+"inertiastart",e.oninertiastart),this}updatePerActionListeners(t,e,s){(l.array(e)||l.object(e))&&this.off(t,e),(l.array(s)||l.object(s))&&this.on(t,s)}setPerAction(t,e){const i=this._defaults;for(const o in e){const r=o,c=this.options[t],h=e[r];"listeners"===r&&this.updatePerActionListeners(t,c.listeners,h),l.array(h)?c[r]=s.from(h):l.plainObject(h)?(c[r]=a(c[r]||{},n(h)),l.object(i.perAction[r])&&"enabled"in i.perAction[r]&&(c[r].enabled=!1!==h.enabled)):l.bool(h)&&l.object(i.perAction[r])?c[r].enabled=h:c[r]=h}}getRect(t){return t=t||(l.element(this.target)?this.target:null),l.string(this.target)&&(t=t||this._context.querySelector(this.target)),o(t)}rectChecker(t){return l.func(t)?(this.getRect=t,this):null===t?(delete this.getRect,this):this.getRect}_backCompatOption(t,e){if(h(e)||l.object(e)){this.options[t]=e;for(const s in this._actions.map)this.options[s][t]=e;return this}return this.options[t]}origin(t){return this._backCompatOption("origin",t)}deltaSource(t){return"page"===t||"client"===t?(this.options.deltaSource=t,this):this.options.deltaSource}context(){return this._context}inContext(t){return this._context===t.ownerDocument||c(this._context,t)}testIgnoreAllow(t,e,s){return!this.testIgnore(t.ignoreFrom,e,s)&&this.testAllow(t.allowFrom,e,s)}testAllow(t,e,s){return!t||!!l.element(s)&&(l.string(t)?r(s,t,e):!!l.element(t)&&c(t,s))}testIgnore(t,e,s){return!(!t||!l.element(s))&&(l.string(t)?r(s,t,e):!!l.element(t)&&c(t,s))}fire(t){return this.events.fire(t),this}_onOff(t,s,n,o){l.object(s)&&!l.array(s)&&(o=n,n=null);const r="on"===t?"add":"remove",c=m(s,n);for(let s in c){"wheel"===s&&(s=i.wheelEvent);for(const i of c[s])e(s,this._actions)?this.events[t](s,i):l.string(this.target)?this._scopeEvents[r+"Delegate"](this.target,this._context,s,i,o):this._scopeEvents[r](this.target,s,i,o)}return this}on(t,e,s){return this._onOff("on",t,e,s)}off(t,e,s){return this._onOff("off",t,e,s)}set(t){const e=this._defaults;l.object(t)||(t={}),this.options=n(e.base);for(const s in this._actions.methodDict){const i=s,n=this._actions.methodDict[i];this.options[i]={},this.setPerAction(i,a(a({},e.perAction),e.actions[i])),this[n](t[i])}for(const e in t)l.func(this[e])&&this[e](t[e]);return this}unset(){if(l.string(this.target))for(const t in this._scopeEvents.delegatedEvents){const e=this._scopeEvents.delegatedEvents[t];for(let s=e.length-1;s>=0;s--){const{selector:i,context:n,listeners:o}=e[s];i===this.target&&n===this._context&&e.splice(s,1);for(let e=o.length-1;e>=0;e--)this._scopeEvents.removeDelegate(this.target,this._context,t,o[e][0],o[e][1])}}else this._scopeEvents.remove(this.target,"all")}}export default Interactable;
//# sourceMappingURL=Interactable.min.js.map
import*as e from"../utils/arr.min.js";import*as t from"../utils/domUtils.min.js";import n from"../utils/extend.min.js";import*as s from"../utils/is.min.js";import r from"../utils/pointerExtend.min.js";import*as i from"../utils/pointerUtils.min.js";export class FakeEvent{constructor(e){this.currentTarget=void 0,this.originalEvent=void 0,this.originalEvent=e,r(this,e)}preventOriginalDefault(){this.originalEvent.preventDefault()}stopPropagation(){this.originalEvent.stopPropagation()}stopImmediatePropagation(){this.originalEvent.stopImmediatePropagation()}}function o(e){if(!s.object(e))return{capture:!!e,passive:!1};const t=n({},e);return t.capture=!!e.capture,t.passive=!!e.passive,t}export default{id:"events",install(n){const r=[],a={},l=[],p={add:c,remove:u,addDelegate(t,n,s,r,i){const p=o(i);if(!a[s]){a[s]=[];for(const e of l)c(e,s,v),c(e,s,f,!0)}const u=a[s];let d=e.find(u,e=>e.selector===t&&e.context===n);d||(d={selector:t,context:n,listeners:[]},u.push(d)),d.listeners.push([r,p])},removeDelegate(e,t,n,s,r){const i=o(r),l=a[n];let p,c=!1;if(l)for(p=l.length-1;p>=0;p--){const r=l[p];if(r.selector===e&&r.context===t){const{listeners:e}=r;for(let r=e.length-1;r>=0;r--){const[o,{capture:a,passive:d}]=e[r];if(o===s&&a===i.capture&&d===i.passive){e.splice(r,1),e.length||(l.splice(p,1),u(t,n,v),u(t,n,f,!0)),c=!0;break}}if(c)break}}},delegateListener:v,delegateUseCapture:f,delegatedEvents:a,documents:l,targets:r,supportsOptions:!1,supportsPassive:!1};function c(t,n,s,i){const a=o(i);let l=e.find(r,e=>e.eventTarget===t);l||(l={eventTarget:t,events:{}},r.push(l)),l.events[n]||(l.events[n]=[]),t.addEventListener&&!e.contains(l.events[n],s)&&(t.addEventListener(n,s,p.supportsOptions?a:a.capture),l.events[n].push(s))}function u(t,n,s,i){const a=o(i),l=e.findIndex(r,e=>e.eventTarget===t),c=r[l];if(!c||!c.events)return;if("all"===n){for(n in c.events)c.events.hasOwnProperty(n)&&u(t,n,"all");return}let v=!1;const f=c.events[n];if(f){if("all"===s){for(let e=f.length-1;e>=0;e--)u(t,n,f[e],a);return}for(let e=0;e<f.length;e++)if(f[e]===s){t.removeEventListener(n,s,p.supportsOptions?a:a.capture),f.splice(e,1),0===f.length&&(delete c.events[n],v=!0);break}}v&&!Object.keys(c.events).length&&r.splice(l,1)}function v(e,n){const r=o(n),l=new FakeEvent(e),p=a[e.type],[c]=i.getEventTargets(e);let u=c;for(;s.element(u);){for(let e=0;e<p.length;e++){const n=p[e],{selector:s,context:i}=n;if(t.matchesSelector(u,s)&&t.nodeContains(i,c)&&t.nodeContains(i,u)){const{listeners:e}=n;l.currentTarget=u;for(const[t,{capture:n,passive:s}]of e)n===r.capture&&s===r.passive&&t(l)}}u=t.parentNode(u)}}function f(e){return v(e,!0)}return n.document.createElement("div").addEventListener("test",null,{get capture(){return p.supportsOptions=!0},get passive(){return p.supportsPassive=!0}}),n.events=p,p}};
//# sourceMappingURL=events.min.js.map